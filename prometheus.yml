# -------------------------------------------
# ğŸ“¡ Prometheus Configuration - prometheus.yml
# ğŸ‘¨â€ğŸ’» Author: Kleilson Santos
# ğŸ“… Last Updated: 2025-06-19
# ğŸ” Description: Prometheus scraping and alerting setup for infrastructure observability.
# ğŸ¯ Monitored Services:
#   - Prometheus, Node Exporter, cAdvisor
#   - Exporters for MongoDB, PostgreSQL, MySQL, Redis, RabbitMQ
#   - Blackbox Exporter (HTTP/ICMP)
#   - API with Spring Boot Actuator
# -------------------------------------------

# ğŸŒ Global configuration
global:
  scrape_interval: 15s           # â±ï¸ Collect metrics every 15 seconds
  evaluation_interval: 15s       # ğŸ” Evaluate alert rules every 15 seconds

# ğŸ“œ Alert rule files
rule_files:
  - "alerts.yml"

# ğŸš¨ Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# ğŸ“¦ Scraping targets
scrape_configs:

  # ğŸ“Š Monitor Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['prometheus:9090']  # ğŸ  Local Prometheus server

  # ğŸ–¥ï¸ Monitor host system resources (CPU, RAM, Disk)
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']  # ğŸ”Œ Default Node Exporter port

  # ğŸ³ Monitor running Docker containers
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']  # ğŸ“¦ cAdvisor metrics endpoint

  # ğŸƒ MongoDB exporter
  - job_name: 'mongodb-exporter'
    static_configs:
      - targets: ['mongodb-exporter:9216']  # ğŸ“Š MongoDB metrics

  # ğŸ˜ PostgreSQL exporter
  - job_name: 'postgres-exporter'
    static_configs:
      - targets: ['postgres-exporter:9187']  # ğŸ“Š PostgreSQL metrics

  # ğŸ¬ MySQL exporter
  - job_name: 'mysql-exporter'
    static_configs:
      - targets: ['mysql-exporter:9104']  # ğŸ“Š MySQL metrics

  # ğŸ§  Redis exporter
  - job_name: 'redis-exporter'
    static_configs:
      - targets: ['redis-exporter:9121']  # ğŸ“Š Redis metrics

  # ğŸ° RabbitMQ exporter
  - job_name: 'rabbitmq-exporter'
    static_configs:
      - targets: ['rabbitmq-exporter:9419']  # ğŸ“Š RabbitMQ metrics

  # ğŸŒ Blackbox Exporter (HTTP probe)
  - job_name: 'blackbox-exporter'
    static_configs:
      - targets: ['blackbox-exporter:9115']  # ğŸ›°ï¸ Blackbox exporter metrics endpoint

  # âš™ï¸ Spring Boot API metrics via Actuator
  - job_name: 'crud-users-api'
    metrics_path: /actuator/prometheus
    params:
      module: [http_2xx, http_3xx, http_4xx, http_5xx]
    static_configs:
      - targets: ['crud-users-api:8089']  # ğŸ§ª Application metrics

  # ğŸŒ Blackbox Exporter for ICMP Ping
  - job_name: 'blackbox-exporter-icmp-ping'
    metrics_path: /probe
    params:
      module: [icmp_ping]
    static_configs:
      - targets:
          - 8.8.8.8  # ğŸ“¡ Google DNS or target IP to monitor
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox-exporter:9115
